<%= render "shared/navbar" %>
<h1><%= @itinerary_group.title %></h1>
<h1>Edit Itinerary Settings</h1>
<% if @itinerary_group.errors.any? %>
  <div class="error-messages">
    <ul>
      <% @itinerary_group.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>
<%= form_with model: @itinerary_group, url: itinerary_path(@itinerary_group), method: :patch, local: true do |f| %>
  <div>
    <%= f.label :title, "Title" %>
    <%= f.text_field :title %>
  </div>
  <div>
    <%= f.label :description, "Description" %>
    <%= f.text_area :description %>
  </div>
  <div>
    <%= f.label :location, "Location" %>
    <%= f.text_field :location %>
  </div>
  <div>
    <%= f.label :start_date, "Start Date" %>
    <%= f.date_field :start_date %>
  </div>
  <div>
    <%= f.label :end_date, "End Date" %>
    <%= f.date_field :end_date %>
  </div>
  <div>
    <%= f.label :is_private, "Trip Type" %>
    <%= f.select :is_private, [['Public', false], ['Private', true]], { selected: @itinerary_group.is_private } %>
  </div>
  
  <div>
    <%= f.label :password, "Trip Password" %>
    <%= f.password_field :password %>
  </div>
  <div>
    <%= f.label :cost, "Trip Cost" %>
    <%= f.number_field :cost, step: 0.01 %>
  </div>

  <!-- Hotels that match the itinerary location -->
  <h3>Available Hotels in <%= @itinerary_group.location %></h3>
  <% if @matching_hotels.any? %>
    <%= f.collection_check_boxes :hotel_ids, @matching_hotels, :id, :name do |b| %>
      <div>
        <%= b.check_box %> <%= b.text %> — Cost: $<%= Hotel.find(b.value).cost %>
      </div>
    <% end %>
  <% else %>
    <p>No hotels available for this location.</p>
  <% end %>

  <!-- Flights that match the itinerary location -->
  <h3>Available Flights to <%= @itinerary_group.location %></h3>
  <% if @matching_flights.any? %>
    <%= f.collection_check_boxes :flight_ids, @matching_flights, :id, :flight_number do |b| %>
      <div>
        <%= b.check_box %> Flight <%= b.text %> —
        From <%= Flight.find(b.value).departure_location %>
        at <%= Flight.find(b.value).departure_time.strftime("%Y-%m-%d %H:%M") %>
      </div>
    <% end %>
  <% else %>
    <p>No flights available for this location.</p>
  <% end %>
  
  <%= f.submit "Save Changes" %>
<% end %>
