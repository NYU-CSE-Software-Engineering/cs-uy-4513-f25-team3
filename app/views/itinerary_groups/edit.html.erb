<%= render "shared/navbar" %>
<h1><%= @itinerary_group.title %></h1>
<h1>Edit Itinerary Settings</h1>
<% if @itinerary_group.errors.any? %>
  <div class="error-messages">
    <ul>
      <% @itinerary_group.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>
<%= form_with model: @itinerary_group, url: itinerary_path(@itinerary_group), method: :patch, local: true do |f| %>
  <div>
    <%= f.label :title, "Title" %>
    <%= f.text_field :title %>
  </div>
  <div>
    <%= f.label :description, "Description" %>
    <%= f.text_area :description %>
  </div>
  <div>
    <%= f.label :location, "Location" %>
    <%= f.text_field :location %>
  </div>
  <div>
    <%= f.label :start_date, "Start Date" %>
    <%= f.date_field :start_date %>
  </div>
  <div>
    <%= f.label :end_date, "End Date" %>
    <%= f.date_field :end_date %>
  </div>
  <div>
    <%= f.label :is_private, "Trip Type" %>
    <%= f.select :is_private, [['Public', false], ['Private', true]], { selected: @itinerary_group.is_private } %>
  </div>
  
  <div>
    <%= f.label :password, "Trip Password" %>
    <%= f.password_field :password %>
  </div>
  <div>
    <%= f.label :cost, "Trip Cost" %>
    <%= f.number_field :cost, step: 0.01 %>
  </div>

  <!-- Hotels that match the itinerary location -->
  <h3>Available Hotels in <%= @itinerary_group.location %></h3>
  <% if @matching_hotels.any? %>
    <%= f.collection_check_boxes :hotel_ids, @matching_hotels, :id, :name do |b| %>
      <% hotel = @matching_hotels.detect { |h| h.id == b.value.to_i } %>

      <div style="border: 1px solid #ccc; padding: 8px; margin-bottom: 6px; border-radius: 6px;">
        <%= b.check_box %>
        <strong><%= hotel.name %></strong><br>

        Location: <%= hotel.location %><br>
        Rating: <%= hotel.rating %><br>
        Cost per night: $<%= hotel.cost %><br>

        Available:
        <%= hotel.arrival_time.strftime("%Y-%m-%d") %>
        to
        <%= hotel.departure_time.strftime("%Y-%m-%d") %>
      </div>
    <% end %>
  <% else %>
    <p>No hotels available for this location.</p>
  <% end %>

  <!-- Flights that match the itinerary location -->
  <h3>Available Flights to <%= @itinerary_group.location %></h3>
  <% if @matching_flights.any? %>
    <%= f.collection_check_boxes :flight_ids, @matching_flights, :id, :flight_number do |b| %>
      <% flight = @matching_flights.detect { |fl| fl.id == b.value.to_i } %>

      <div style="border: 1px solid #ccc; padding: 12px; margin-bottom: 10px; border-radius: 6px;">

        <%= b.check_box %>
        <strong>Flight <%= flight.flight_number %></strong><br><br>

        <!-- Flex container for side-by-side columns -->
        <div style="display: flex; justify-content: space-between; gap: 20px;">

          <!-- Departure Column -->
          <div style="flex: 1;">
            <strong>Departure</strong><br>
            From: <%= flight.departure_location %><br>
            Date: <%= flight.departure_time.strftime("%Y-%m-%d") %><br>
            Time: <%= flight.departure_time.strftime("%H:%M") %>
          </div>

          <!-- Arrival Column -->
          <div style="flex: 1;">
            <strong>Arrival</strong><br>
            To: <%= flight.arrival_location %><br>
            Date: <%= flight.arrival_time.strftime("%Y-%m-%d") %><br>
            Time: <%= flight.arrival_time.strftime("%H:%M") %>
          </div>

        </div>

        <!-- Cost shown below -->
        <div style="margin-top: 12px;">
          Cost: $<%= flight.cost %>
        </div>

      </div>
    <% end %>
<% else %>
  <p>No flights available for this location.</p>
<% end %>
  <%= f.submit "Save Changes" %>
<% end %>
